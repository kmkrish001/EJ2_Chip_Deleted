'use strict';

var gulp = global.gulp = global.gulp || require('gulp');
var fs = global.fs = global.fs || require('fs');
var common = global.config = global.config || require('../utils/common.js');
var simpleGit = global.simpleGit = global.simpleGit || require('simple-git');
var currentPackage = common.currentPackage;

gulp.task('blazor-publish', function (done) {
    if (fs.existsSync('./third-party/blazor')) {
        var user = process.env.GITLAB_USER;
        var token = process.env.GITLAB_TOKEN;
        var stageBranch = common.isMasterBranch ? 'master' : 'development';
        stageBranch = common.isReleaseBranch ? process.env.BRANCH_NAME : stageBranch;
        stageBranch = common.isHotfixBranch ? process.env.BRANCH_NAME : stageBranch;
        var ej2aspRepo = 'https://' + user + ':' + token + '@gitlab.syncfusion.com/essential-studio/ej2-blazor-source.git';

        simpleGit('./third-party/blazor').init()
            .add('.')
            .commit('(EJ2-000): ' + currentPackage + ' blazor properties published')
            .push(ej2aspRepo, stageBranch, function () {
                console.log(currentPackage + ' - package published in gitlab');
                done();
            });

    } else {
        done();
    }
});